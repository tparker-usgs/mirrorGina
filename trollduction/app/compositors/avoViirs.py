import mpop.imageo.geo_image as geo_image
#from PIL import Image
from pydecorate import DecoratorAGG
import aggdraw
from trollimage.colormap import rdgy
from trollimage.colormap import Colormap
from trollsched.satpass import Pass
from pprint import pprint
from mpop.projector import get_area_def


C0 = 273.15

def avoir(self):
    """Make a black and white image of the IR 10.8um channel (320m).
       Modeled after mpop.instruments.viirs.ir108
    """
    self.check_channels("M15")
    data = self["M15"].data
    range = (-65 + C0, 35 + C0)
    img = geo_image.GeoImage((data, data, data),
                                self.area,
                                self.time_slot,
                                fill_value=None,
                                mode="RGB",
                                crange=(range, range, range))
    # clouds should be white
    img.enhance(inverse=True)

    return img
avoir.prerequisites = set(["M15"])


def avoirhr(self):
    """Make a black and white image of the IR 10.8um channel (320m).
       Modeled after mpop.instruments.viirs.ir108
    """
    self.check_channels("I05")
    data = self["I05"].data
    range = (-65 + C0, 35 + C0)
    img = geo_image.GeoImage((data, data, data),
                                self.area,
                                self.time_slot,
                                fill_value=None,
                                mode="RGB",
                                crange=(range, range, range))
    # clouds should be white
    img.enhance(inverse=True)

    return img
avoirhr.prerequisites = set(["I05"])


def avovis(self):
    """Make a black and white image of the IR 10.8um channel (320m).
       Modeled after mpop.instruments.viirs.ir108
    """
    self.check_channels("I01")
    data = self["I01"].data
    range = (0 + C0, 100 + C0)
    img = geo_image.GeoImage((data, data, data),
                                self.area,
                                self.time_slot,
                                fill_value=None,
                                mode="RGB",
                                crange=(range, range, range))
    # clouds should be white
    img.enhance(inverse=True)

    return img
avovis.prerequisites = set(["I01"])


def avomir(self):
    """Make a black and white image of the IR 10.8um channel (320m).
       Modeled after mpop.instruments.viirs.ir108
    """
    self.check_channels("I04")
    data = self["I04"].data
    range = (-50 + C0, 50 + C0)
    img = geo_image.GeoImage((data, data, data),
                                self.area,
                                self.time_slot,
                                fill_value=None,
                                mode="RGB",
                                crange=(range, range, range))
    return img
avomir.prerequisites = set(["I04"])
avomir.colormap = Colormap((0.0, (0.0, 0.0, 0.0)),
                           (1.0, (1.0, 1.0, 1.0)))


def avobtd(self):
    """Make BTD composite.
    """
    self.check_channels('M15', 'M16')
    img = geo_image.GeoImage(self["M15"].data - self["M16"].data,
                             self.area,
                             self.time_slot,
                             fill_value=None,
                             mode="L",
                             crange=(-6, 5))
    img.colorize(Colormap(avobtd.colors))
    return img
avobtd.prerequisites = set(["M15", "M16"])
avobtd.colors = ((0.0, (0.5, 0.0, 0.0)),
                 (0.071428, (1.0, 0.0, 0.0)),
                 (0.142856, (1.0, 0.5, 0.0)),
                 (0.214284, (1.0, 1.0, 0.0)),
                 (0.285712, (0.5, 1.0, 0.5)),
                 (0.357140, (0.0, 1.0, 1.0)),
                 (0.428568, (0.0, 0.5, 1.0)),
                 (0.499999, (0.0, 0.0, 1.0)),
                 (0.5000, (0.5, 0.5, 0.5)),
                 (1.0, (1.0, 1.0, 1.0)))
avobtd.colormap = Colormap(avobtd.colors)
avobtd.colormap2 = Colormap((0.000000, (200, 48, 7)),
                           (0.007843, (194, 49, 6)),
                           (0.011765, (196, 51, 7)),
                           (0.015686, (199, 53, 7)),
                           (0.019608, (202, 55, 7)),
                           (0.023529, (204, 57, 8)),
                           (0.027451, (207, 60, 8)),
                           (0.031373, (210, 62, 8)),
                           (0.035294, (213, 65, 9)),
                           (0.039216, (217, 67, 9)),
                           (0.043137, (220, 70, 10)),
                           (0.047059, (224, 74, 11)),
                           (0.050980, (227, 76, 11)),
                           (0.054902, (232, 80, 12)),
                           (0.058824, (235, 82, 12)),
                           (0.062745, (238, 85, 12)),
                           (0.066667, (241, 88, 13)),
                           (0.070588, (244, 90, 13)),
                           (0.074510, (247, 92, 13)),
                           (0.078431, (250, 94, 14)),
                           (0.082353, (255, 100, 15)),
                           (0.086275, (255, 105, 16)),
                           (0.090196, (255, 110, 17)),
                           (0.094118, (255, 114, 18)),
                           (0.098039, (255, 120, 19)),
                           (0.101961, (255, 125, 21)),
                           (0.105882, (255, 130, 22)),
                           (0.109804, (255, 135, 23)),
                           (0.113725, (255, 140, 24)),
                           (0.117647, (255, 145, 26)),
                           (0.121569, (255, 154, 28)),
                           (0.125490, (255, 160, 29)),
                           (0.129412, (255, 165, 30)),
                           (0.133333, (255, 171, 32)),
                           (0.137255, (255, 177, 33)),
                           (0.141176, (255, 182, 34)),
                           (0.145098, (255, 188, 36)),
                           (0.149020, (255, 192, 37)),
                           (0.152941, (255, 198, 38)),
                           (0.156863, (255, 200, 39)),
                           (0.160784, (255, 207, 40)),
                           (0.164706, (255, 209, 41)),
                           (0.168627, (255, 213, 42)),
                           (0.172549, (255, 219, 44)),
                           (0.176471, (255, 224, 45)),
                           (0.180392, (255, 226, 45)),
                           (0.184314, (255, 237, 48)),
                           (0.188235, (253, 238, 49)),
                           (0.192157, (246, 238, 55)),
                           (0.196078, (238, 239, 61)),
                           (0.200000, (234, 239, 64)),
                           (0.203922, (228, 239, 69)),
                           (0.207843, (220, 240, 75)),
                           (0.211765, (216, 240, 78)),
                           (0.215686, (209, 241, 83)),
                           (0.219608, (200, 241, 90)),
                           (0.223529, (188, 242, 98)),
                           (0.227451, (181, 243, 104)),
                           (0.231373, (172, 243, 111)),
                           (0.235294, (162, 244, 118)),
                           (0.239216, (158, 244, 120)),
                           (0.243137, (153, 245, 125)),
                           (0.247059, (144, 245, 132)),
                           (0.250980, (133, 246, 139)),
                           (0.254902, (131, 246, 142)),
                           (0.258824, (126, 247, 145)),
                           (0.262745, (116, 247, 154)),
                           (0.266667, (114, 247, 155)),
                           (0.270588, (108, 248, 159)),
                           (0.274510, (97, 249, 167)),
                           (0.278431, (93, 249, 170)),
                           (0.282353, (88, 249, 174)),
                           (0.286275, (79, 250, 181)),
                           (0.290196, (76, 250, 183)),
                           (0.294118, (69, 251, 188)),
                           (0.298039, (61, 251, 194)),
                           (0.301961, (56, 252, 198)),
                           (0.305882, (51, 252, 202)),
                           (0.309804, (41, 253, 209)),
                           (0.313725, (39, 253, 210)),
                           (0.317647, (31, 253, 216)),
                           (0.321569, (14, 255, 226)),
                           (0.325490, (13, 255, 227)),
                           (0.329412, (13, 252, 228)),
                           (0.333333, (13, 247, 230)),
                           (0.337255, (12, 242, 232)),
                           (0.341176, (11, 238, 234)),
                           (0.345098, (11, 235, 235)),
                           (0.349020, (11, 231, 237)),
                           (0.352941, (10, 228, 238)),
                           (0.356863, (10, 226, 239)),
                           (0.360784, (10, 223, 240)),
                           (0.364706, (9, 221, 241)),
                           (0.368627, (9, 218, 242)),
                           (0.372549, (9, 216, 243)),
                           (0.376471, (8, 213, 244)),
                           (0.380392, (8, 211, 245)),
                           (0.384314, (8, 208, 246)),
                           (0.388235, (7, 204, 248)),
                           (0.392157, (7, 201, 249)),
                           (0.396078, (6, 196, 251)),
                           (0.400000, (5, 189, 254)),
                           (0.403922, (5, 182, 255)),
                           (0.407843, (5, 174, 255)),
                           (0.411765, (5, 169, 255)),
                           (0.415686, (5, 162, 255)),
                           (0.419608, (5, 158, 255)),
                           (0.423529, (5, 152, 255)),
                           (0.427451, (5, 144, 255)),
                           (0.431373, (5, 139, 255)),
                           (0.435294, (5, 132, 255)),
                           (0.439216, (5, 130, 255)),
                           (0.443137, (5, 123, 255)),
                           (0.447059, (5, 118, 255)),
                           (0.450980, (5, 115, 255)),
                           (0.454902, (5, 109, 255)),
                           (0.458824, (5, 104, 255)),
                           (0.462745, (5, 101, 255)),
                           (0.466667, (5, 94, 255)),
                           (0.470588, (5, 90, 255)),
                           (0.474510, (5, 87, 255)),
                           (0.478431, (5, 79, 255)),
                           (0.482353, (5, 72, 255)),
                           (0.486275, (5, 65, 255)),
                           (0.490196, (5, 60, 255)),
                           (0.494118, (5, 52, 255)),
                           (0.498039, (5, 50, 255)),
                           (0.501961, (5, 38, 255)),
                           (0.505882, (5, 30, 255)),
                           (0.509804, (5, 28, 255)),
                           (0.513725, (5, 20, 255)),
                           (0.517647, (5, 14, 255)),
                           (0.521569, (1, 4, 255)),
                           (0.525490, (125, 125, 125)),
                           (0.529412, (127, 127, 127)),
                           (0.533333, (128, 128, 128)),
                           (0.537255, (129, 129, 129)),
                           (0.541176, (130, 130, 130)),
                           (0.545098, (131, 131, 131)),
                           (0.549020, (132, 132, 132)),
                           (0.552941, (133, 133, 133)),
                           (0.556863, (134, 134, 134)),
                           (0.560784, (135, 135, 135)),
                           (0.564706, (136, 136, 136)),
                           (0.568627, (137, 137, 137)),
                           (0.572549, (138, 138, 138)),
                           (0.576471, (139, 139, 139)),
                           (0.580392, (140, 140, 140)),
                           (0.584314, (141, 141, 141)),
                           (0.588235, (143, 143, 143)),
                           (0.592157, (144, 144, 144)),
                           (0.596078, (145, 145, 145)),
                           (0.600000, (146, 146, 146)),
                           (0.603922, (147, 147, 147)),
                           (0.607843, (148, 148, 148)),
                           (0.611765, (149, 149, 149)),
                           (0.615686, (150, 150, 150)),
                           (0.619608, (151, 151, 151)),
                           (0.623529, (152, 152, 152)),
                           (0.627451, (153, 153, 153)),
                           (0.631373, (154, 154, 154)),
                           (0.635294, (155, 155, 155)),
                           (0.639216, (156, 156, 156)),
                           (0.643137, (158, 158, 158)),
                           (0.647059, (159, 159, 159)),
                           (0.650980, (160, 160, 160)),
                           (0.654902, (161, 161, 161)),
                           (0.658824, (162, 162, 162)),
                           (0.662745, (163, 163, 163)),
                           (0.666667, (164, 164, 164)),
                           (0.670588, (165, 165, 165)),
                           (0.674510, (166, 166, 166)),
                           (0.678431, (167, 167, 167)),
                           (0.682353, (168, 168, 168)),
                           (0.686275, (169, 169, 169)),
                           (0.690196, (170, 170, 170)),
                           (0.694118, (171, 171, 171)),
                           (0.698039, (173, 173, 173)),
                           (0.701961, (174, 174, 174)),
                           (0.705882, (175, 175, 175)),
                           (0.709804, (176, 176, 176)),
                           (0.713725, (177, 177, 177)),
                           (0.717647, (178, 178, 178)),
                           (0.721569, (179, 179, 179)),
                           (0.725490, (180, 180, 180)),
                           (0.729412, (181, 181, 181)),
                           (0.733333, (182, 182, 182)),
                           (0.737255, (183, 183, 183)),
                           (0.741176, (184, 184, 184)),
                           (0.745098, (185, 185, 185)),
                           (0.749020, (186, 186, 186)),
                           (0.752941, (188, 188, 188)),
                           (0.756863, (189, 189, 189)),
                           (0.760784, (190, 190, 190)),
                           (0.764706, (191, 191, 191)),
                           (0.768627, (192, 192, 192)),
                           (0.772549, (193, 193, 193)),
                           (0.776471, (194, 194, 194)),
                           (0.780392, (195, 195, 195)),
                           (0.784314, (196, 196, 196)),
                           (0.788235, (197, 197, 197)),
                           (0.792157, (198, 198, 198)),
                           (0.796078, (199, 199, 199)),
                           (0.800000, (200, 200, 200)),
                           (0.803922, (201, 201, 201)),
                           (0.807843, (203, 203, 203)),
                           (0.811765, (204, 204, 204)),
                           (0.815686, (205, 205, 205)),
                           (0.819608, (206, 206, 206)),
                           (0.823529, (207, 207, 207)),
                           (0.827451, (208, 208, 208)),
                           (0.831373, (209, 209, 209)),
                           (0.835294, (210, 210, 210)),
                           (0.839216, (211, 211, 211)),
                           (0.843137, (212, 212, 212)),
                           (0.847059, (213, 213, 213)),
                           (0.850980, (214, 214, 214)),
                           (0.854902, (215, 215, 215)),
                           (0.858824, (216, 216, 216)),
                           (0.862745, (218, 218, 218)),
                           (0.866667, (219, 219, 219)),
                           (0.870588, (220, 220, 220)),
                           (0.874510, (221, 221, 221)),
                           (0.878431, (222, 222, 222)),
                           (0.882353, (223, 223, 223)),
                           (0.886275, (224, 224, 224)),
                           (0.890196, (225, 225, 225)),
                           (0.894118, (226, 226, 226)),
                           (0.898039, (227, 227, 227)),
                           (0.901961, (228, 228, 228)),
                           (0.905882, (229, 229, 229)),
                           (0.909804, (230, 230, 230)),
                           (0.913725, (231, 231, 231)),
                           (0.917647, (233, 233, 233)),
                           (0.921569, (234, 234, 234)),
                           (0.925490, (235, 235, 235)),
                           (0.929412, (236, 236, 236)),
                           (0.933333, (237, 237, 237)),
                           (0.937255, (238, 238, 238)),
                           (0.941176, (239, 239, 239)),
                           (0.945098, (240, 240, 240)),
                           (0.949020, (241, 241, 241)),
                           (0.952941, (242, 242, 242)),
                           (0.956863, (243, 243, 243)),
                           (0.960784, (244, 244, 244)),
                           (0.964706, (245, 245, 245)),
                           (0.968627, (246, 246, 246)),
                           (0.972549, (248, 248, 248)),
                           (0.976471, (249, 249, 249)),
                           (0.980392, (250, 250, 250)),
                           (0.984314, (251, 251, 251)),
                           (0.988235, (252, 252, 252)),
                           (0.992157, (253, 253, 253)),
                           (0.996078, (254, 254, 254)),
                           (1.000000, (255, 255, 255)))

viirs = [avoir, avoirhr, avobtd, avovis, avomir]
